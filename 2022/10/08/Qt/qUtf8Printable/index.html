<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>qUtf8Printable | Vinda's Blog</title><meta name="keywords" content="Qt"><meta name="author" content="Vinda"><meta name="copyright" content="Vinda"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="函数介绍及注意事项  **const char *qPrintable(const QString &amp;str)**  Returns str as a const char *. This is equivalent to str.toLocal8Bit().constData(). The char pointer will be invalid after the statement">
<meta property="og:type" content="article">
<meta property="og:title" content="qUtf8Printable">
<meta property="og:url" content="https://svinda.github.io/2022/10/08/Qt/qUtf8Printable/index.html">
<meta property="og:site_name" content="Vinda&#39;s Blog">
<meta property="og:description" content="函数介绍及注意事项  **const char *qPrintable(const QString &amp;str)**  Returns str as a const char *. This is equivalent to str.toLocal8Bit().constData(). The char pointer will be invalid after the statement">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://svinda.github.io/img/avatar.jpg">
<meta property="article:published_time" content="2022-10-07T18:53:48.000Z">
<meta property="article:modified_time" content="2022-10-08T01:11:58.809Z">
<meta property="article:author" content="Vinda">
<meta property="article:tag" content="Qt">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://svinda.github.io/img/avatar.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://svinda.github.io/2022/10/08/Qt/qUtf8Printable/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?7c5117dc3f15bc5a9f3d98c41f2a8335";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'qUtf8Printable',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-10-08 09:11:58'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.1.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">87</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">24</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Vinda's Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">qUtf8Printable</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-10-07T18:53:48.000Z" title="发表于 2022-10-08 02:53:48">2022-10-08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-10-08T01:11:58.809Z" title="更新于 2022-10-08 09:11:58">2022-10-08</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Qt/">Qt</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="qUtf8Printable"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div><article class="post-content" id="article-container"><h2 id="函数介绍及注意事项">函数介绍及注意事项</h2>
<ul>
<li><code>**const char *qPrintable(const QString &amp;str)</code>**</li>
</ul>
<p>Returns str as a <code>const char *</code>. This is equivalent to <code>str.toLocal8Bit().constData()</code>.<br>
The char pointer will be invalid after the statement in which <code>qPrintable()</code> is used. This is because the array returned by <code>QString::toLocal8Bit()</code> will fall out of scope.</p>
<blockquote>
<p>Note: qDebug(), qInfo(), qWarning(), qCritical(), qFatal() expect %s arguments to be UTF-8 encoded, while qPrintable() converts to local 8-bit encoding. Therefore qUtf8Printable() should be used for logging strings instead of qPrintable().<br>
注意：qDebug()、qInfo()、qWarning()、qCritical() 和 qFatal() 要求 %s 参数采用 UTF-8 编码，而 qPrintable() 则转换为本地 8 位编码。因此，应该使用 qUtf8Printable() 来记录字符串，而不是 qPrintable()。</p>
</blockquote>
<ul>
<li><code>**const char *qUtf8Printable(const QString &amp;str)</code>**</li>
</ul>
<p>Returns str as a <code>const char *</code>. This is equivalent to <code>str.toUtf8().constData()</code>.<br>
The char pointer will be invalid after the statement in which <code>qUtf8Printable()</code> is used. This is because the array returned by <code>QString::toUtf8()</code> will fall out of scope.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Qt Example</span></span><br><span class="line"><span class="built_in">qWarning</span>(<span class="string">&quot;%s: %s&quot;</span>, <span class="built_in">qUtf8Printable</span>(key), <span class="built_in">qUtf8Printable</span>(value));</span><br><span class="line"></span><br><span class="line"><span class="comment">// My Example</span></span><br><span class="line">QString str = <span class="string">&quot;中文&quot;</span>;</span><br><span class="line"><span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;中文&quot;</span> &lt;&lt; str; <span class="comment">// 中文 &quot;中文&quot; （输出的 str 有双引号）</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">qDebug</span>(<span class="string">&quot;%s&quot;</span>, <span class="built_in">qPrintable</span>(str));</span><br><span class="line"><span class="built_in">qDebug</span>(<span class="string">&quot;%s&quot;</span>, <span class="built_in">qPrintable</span>(<span class="string">&quot;中文&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="built_in">qDebug</span>(<span class="string">&quot;%s&quot;</span>, <span class="built_in">qUtf8Printable</span>(str));</span><br><span class="line"><span class="built_in">qDebug</span>(<span class="string">&quot;%s&quot;</span>, <span class="built_in">qUtf8Printable</span>(<span class="string">&quot;中文&quot;</span>));</span><br><span class="line"><span class="comment">// 无法确保输出的字符串是否有中文，建议使用 qUtf8Printable</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 程序输出:</span></span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment">中文 &quot;中文&quot;</span></span><br><span class="line"><span class="comment">????</span></span><br><span class="line"><span class="comment">????</span></span><br><span class="line"><span class="comment">中文</span></span><br><span class="line"><span class="comment">中文</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h2 id="一些开源项目中使用的例子">一些开源项目中使用的例子</h2>
<p>Example#1<br>
File: application.cpp Project: suratovvlad/qBittorrent</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Application::initializeTranslation</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Preferences *<span class="type">const</span> pref = Preferences::<span class="built_in">instance</span>();</span><br><span class="line">    <span class="comment">// Load translation</span></span><br><span class="line">    QString localeStr = pref-&gt;<span class="built_in">getLocale</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (m_qtTranslator.<span class="built_in">load</span>(<span class="built_in">QLatin1String</span>(<span class="string">&quot;qtbase_&quot;</span>) + localeStr, QLibraryInfo::<span class="built_in">location</span>(QLibraryInfo::TranslationsPath)) ||</span><br><span class="line">        m_qtTranslator.<span class="built_in">load</span>(<span class="built_in">QLatin1String</span>(<span class="string">&quot;qt_&quot;</span>) + localeStr, QLibraryInfo::<span class="built_in">location</span>(QLibraryInfo::TranslationsPath)))</span><br><span class="line">            <span class="built_in">qDebug</span>(<span class="string">&quot;Qt %s locale recognized, using translation.&quot;</span>, <span class="built_in">qUtf8Printable</span>(localeStr));</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">qDebug</span>(<span class="string">&quot;Qt %s locale unrecognized, using default (en).&quot;</span>, <span class="built_in">qUtf8Printable</span>(localeStr));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">installTranslator</span>(&amp;m_qtTranslator);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (m_translator.<span class="built_in">load</span>(<span class="built_in">QLatin1String</span>(<span class="string">&quot;:/lang/qbittorrent_&quot;</span>) + localeStr))</span><br><span class="line">        <span class="built_in">qDebug</span>(<span class="string">&quot;%s locale recognized, using translation.&quot;</span>, <span class="built_in">qUtf8Printable</span>(localeStr));</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">qDebug</span>(<span class="string">&quot;%s locale unrecognized, using default (en).&quot;</span>, <span class="built_in">qUtf8Printable</span>(localeStr));</span><br><span class="line">    <span class="built_in">installTranslator</span>(&amp;m_translator);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> DISABLE_GUI</span></span><br><span class="line">    <span class="keyword">if</span> (localeStr.<span class="built_in">startsWith</span>(<span class="string">&quot;ar&quot;</span>) || localeStr.<span class="built_in">startsWith</span>(<span class="string">&quot;he&quot;</span>)) &#123;</span><br><span class="line">        <span class="built_in">qDebug</span>(<span class="string">&quot;Right to Left mode&quot;</span>);</span><br><span class="line">        <span class="built_in">setLayoutDirection</span>(Qt::RightToLeft);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">setLayoutDirection</span>(Qt::LeftToRight);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Example#2<br>
File: proxycgt.cpp Project: CriDos/HiAsm_Interface</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">printParamArgs</span><span class="params">(CgtParams index, <span class="type">const</span> QVariant &amp;value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     <span class="built_in">qInfo</span>(<span class="string">&quot;  Arg1: %s&quot;</span>, <span class="built_in">qUtf8Printable</span>(CgtParamsMap[index])); <span class="comment">//-V108</span></span><br><span class="line">     <span class="keyword">if</span> (value.<span class="built_in">type</span>() == QVariant::String) &#123;</span><br><span class="line">         <span class="built_in">qInfo</span>(<span class="string">&quot;  Arg2: \&quot;%s\&quot;&quot;</span>, <span class="built_in">qUtf8Printable</span>(value.<span class="built_in">toString</span>()));</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="built_in">qInfo</span>(<span class="string">&quot;  Arg2: %s&quot;</span>, <span class="built_in">qUtf8Printable</span>(value.<span class="built_in">toString</span>()));</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Example#3<br>
File: Multicaster.cpp Project: 171767313/MultiChat</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Multicaster::readyRead</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (socket-&gt;<span class="built_in">hasPendingDatagrams</span>()) &#123;</span><br><span class="line">        QByteArray datagram;</span><br><span class="line">        datagram.<span class="built_in">resize</span>(socket-&gt;<span class="built_in">pendingDatagramSize</span>());</span><br><span class="line"></span><br><span class="line">        QHostAddress senderAddr;</span><br><span class="line">        quint16 senderPort;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Here it is assumed that if a datagram is fragmented, it can</span></span><br><span class="line">        <span class="comment">// be dismissed and treated as a UDP unreliability</span></span><br><span class="line">        qint64 r = socket-&gt;<span class="built_in">readDatagram</span>(datagram.<span class="built_in">data</span>(), datagram.<span class="built_in">size</span>(),</span><br><span class="line">            &amp;senderAddr, &amp;senderPort);</span><br><span class="line">        <span class="keyword">if</span> (r != datagram.<span class="built_in">size</span>())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Ignore errors and datagrams of incorrect size.</span></span><br><span class="line">            <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Multicaster::readyRead()&quot;</span></span><br><span class="line">                &lt;&lt; <span class="string">&quot;readDatagram() returned&quot;</span> &lt;&lt; r &lt;&lt; <span class="string">&quot;, but&quot;</span></span><br><span class="line">                &lt;&lt; datagram.<span class="built_in">size</span>() &lt;&lt; <span class="string">&quot;expected. Ignored.&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (senderPort != settings.port) &#123;</span><br><span class="line">            <span class="comment">// Ignore datagrams sent from unknown ports.</span></span><br><span class="line">            <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Multicaster::readyRead()&quot;</span></span><br><span class="line">                &lt;&lt; <span class="string">&quot;Received datagram from port&quot;</span> &lt;&lt; senderPort</span><br><span class="line">                &lt;&lt; <span class="string">&quot;, but expected port is&quot;</span> &lt;&lt; settings.port</span><br><span class="line">                &lt;&lt; <span class="string">&quot;. Ignored.&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (senderAddr == ownIp) &#123;</span><br><span class="line">            <span class="comment">// Ignore datagrams sent by this host to itself.</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Debug.</span></span><br><span class="line">        <span class="keyword">if</span> (settings.debugWasteEachNthDatagramReceived &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">static</span> <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span> (++count % settings.debugWasteEachNthDatagramReceived == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">DEBUG_LOG_WASTED</span>(<span class="string">&quot;    &quot;</span> &lt;&lt; datagram &lt;&lt; <span class="string">&quot;&lt;-x-&quot;</span></span><br><span class="line">                    &lt;&lt; <span class="built_in">qUtf8Printable</span>(senderAddr.<span class="built_in">toString</span>()));</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">LOG</span>(<span class="string">&quot;    &quot;</span> &lt;&lt; datagram &lt;&lt; <span class="string">&quot;&lt;---&quot;</span></span><br><span class="line">            &lt;&lt; <span class="built_in">qUtf8Printable</span>(senderAddr.<span class="built_in">toString</span>()));</span><br><span class="line"></span><br><span class="line">        <span class="function">emit <span class="title">datagramReceived</span><span class="params">(datagram, senderAddr.toString())</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Example#4<br>
File: filter_expression_toolbar.cpp Project: ljakab/wireshark</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">FilterExpressionToolBar::onFilterDropped</span><span class="params">(QString description, QString filter)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ( filter.<span class="built_in">length</span>() == <span class="number">0</span> )</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">filter_expression_new</span>(<span class="built_in">qUtf8Printable</span>(description),</span><br><span class="line">            <span class="built_in">qUtf8Printable</span>(filter), <span class="built_in">qUtf8Printable</span>(description), TRUE);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">save_migrated_uat</span>(<span class="string">&quot;Display expressions&quot;</span>, &amp;prefs.filter_expressions_old);</span><br><span class="line">    <span class="built_in">filterExpressionsChanged</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Example#5<br>
File: programupdater.cpp Project: elFarto/qBittorrent</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">ProgramUpdater::rssDownloadFinished</span><span class="params">(<span class="type">const</span> QString &amp;url, <span class="type">const</span> QByteArray &amp;data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">Q_UNUSED</span>(url);</span><br><span class="line">    <span class="built_in">qDebug</span>(<span class="string">&quot;Finished downloading the new qBittorrent updates RSS&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> Q_OS_MAC</span></span><br><span class="line">    <span class="type">const</span> QString OS_TYPE &#123;<span class="string">&quot;Mac OS X&quot;</span>&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">elif</span> defined(Q_OS_WIN)</span></span><br><span class="line">    <span class="type">const</span> QString OS_TYPE &#123;((QSysInfo::<span class="built_in">windowsVersion</span>() &gt;= QSysInfo::WV_WINDOWS7)</span><br><span class="line">            &amp;&amp; QSysInfo::<span class="built_in">currentCpuArchitecture</span>().<span class="built_in">endsWith</span>(<span class="string">&quot;64&quot;</span>))</span><br><span class="line">        ? <span class="string">&quot;Windows x64&quot;</span> : <span class="string">&quot;Windows&quot;</span>&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    QString version;</span><br><span class="line">    <span class="function">QXmlStreamReader <span class="title">xml</span><span class="params">(data)</span></span>;</span><br><span class="line">    <span class="type">bool</span> inItem = <span class="literal">false</span>;</span><br><span class="line">    QString updateLink;</span><br><span class="line">    QString type;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!xml.<span class="built_in">atEnd</span>()) &#123;</span><br><span class="line">        xml.<span class="built_in">readNext</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (xml.<span class="built_in">isStartElement</span>()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (xml.<span class="built_in">name</span>() == <span class="string">&quot;item&quot;</span>)</span><br><span class="line">                inItem = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (inItem &amp;&amp; xml.<span class="built_in">name</span>() == <span class="string">&quot;link&quot;</span>)</span><br><span class="line">                updateLink = <span class="built_in">getStringValue</span>(xml);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (inItem &amp;&amp; xml.<span class="built_in">name</span>() == <span class="string">&quot;type&quot;</span>)</span><br><span class="line">                type = <span class="built_in">getStringValue</span>(xml);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (inItem &amp;&amp; xml.<span class="built_in">name</span>() == <span class="string">&quot;version&quot;</span>)</span><br><span class="line">                version = <span class="built_in">getStringValue</span>(xml);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (xml.<span class="built_in">isEndElement</span>()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (inItem &amp;&amp; xml.<span class="built_in">name</span>() == <span class="string">&quot;item&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (type.<span class="built_in">compare</span>(OS_TYPE, Qt::CaseInsensitive) == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="built_in">qDebug</span>(<span class="string">&quot;The last update available is %s&quot;</span>, <span class="built_in">qUtf8Printable</span>(version));</span><br><span class="line">                    <span class="keyword">if</span> (!version.<span class="built_in">isEmpty</span>()) &#123;</span><br><span class="line">                        <span class="built_in">qDebug</span>(<span class="string">&quot;Detected version is %s&quot;</span>, <span class="built_in">qUtf8Printable</span>(version));</span><br><span class="line">                        <span class="keyword">if</span> (<span class="built_in">isVersionMoreRecent</span>(version))</span><br><span class="line">                            m_updateUrl = updateLink;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                inItem = <span class="literal">false</span>;</span><br><span class="line">                updateLink.<span class="built_in">clear</span>();</span><br><span class="line">                type.<span class="built_in">clear</span>();</span><br><span class="line">                version.<span class="built_in">clear</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">emit <span class="title">updateCheckFinished</span><span class="params">(!m_updateUrl.isEmpty(), version, m_invokedByUser)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Example#6<br>
File: fs.cpp Project: zywo/qBittorrent</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> Utils::Fs::<span class="built_in">isRegularFile</span>(<span class="type">const</span> QString &amp;path)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">struct</span> ::stat st;</span><br><span class="line">    <span class="keyword">if</span> (::<span class="built_in">stat</span>(path.<span class="built_in">toUtf8</span>().<span class="built_in">constData</span>(), &amp;st) != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">//  analyse erno and log the error</span></span><br><span class="line">        <span class="type">const</span> <span class="keyword">auto</span> err = errno;</span><br><span class="line">        <span class="built_in">qDebug</span>(<span class="string">&quot;Could not get file stats for path &#x27;%s&#x27;. Error: %s&quot;</span></span><br><span class="line">               , <span class="built_in">qUtf8Printable</span>(path), <span class="built_in">qUtf8Printable</span>(<span class="built_in">strerror</span>(err)));</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (st.st_mode &amp; S_IFMT) == S_IFREG;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Example#7<br>
File: ChatController.cpp Project: conreality/conreality-console</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span></span></span><br><span class="line"><span class="function"><span class="title">ChatController::sendMessage</span><span class="params">(<span class="type">const</span> QString&amp; text)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">qDebug</span>(<span class="string">&quot;chat.sendMessage(\&quot;%s\&quot;)&quot;</span>, <span class="built_in">qUtf8Printable</span>(text)); <span class="comment">// DEBUG</span></span><br><span class="line"></span><br><span class="line">  QSqlQuery sql_query;</span><br><span class="line">  sql_query.<span class="built_in">prepare</span>(<span class="string">&quot;SELECT conreality.message_send(session_user, ?)&quot;</span>);</span><br><span class="line">  sql_query.<span class="built_in">bindValue</span>(<span class="number">0</span>, text);</span><br><span class="line">  sql_query.<span class="built_in">exec</span>();</span><br><span class="line">  <span class="type">const</span> <span class="keyword">auto</span> error = sql_query.<span class="built_in">lastError</span>();</span><br><span class="line">  <span class="keyword">if</span> (error.<span class="built_in">isValid</span>()) &#123;</span><br><span class="line">    <span class="built_in">qFatal</span>(<span class="string">&quot;PostgreSQL: %s.&quot;</span>, <span class="built_in">qUtf8Printable</span>(error.<span class="built_in">text</span>()));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Example#8<br>
File: LdapPlugin.cpp Project: edceza/veyon</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">CommandLinePluginInterface::RunResult <span class="title">LdapPlugin::handle_query</span><span class="params">( <span class="type">const</span> QStringList&amp; arguments )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QString objectType = arguments.<span class="built_in">value</span>( <span class="number">0</span> );</span><br><span class="line">    QString filter = arguments.<span class="built_in">value</span>( <span class="number">1</span> );</span><br><span class="line">    QStringList results;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>( objectType == <span class="string">&quot;rooms&quot;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        results = <span class="built_in">ldapDirectory</span>().<span class="built_in">computerRooms</span>( filter );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>( objectType == <span class="string">&quot;computers&quot;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        results = <span class="built_in">ldapDirectory</span>().<span class="built_in">computers</span>( filter );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>( objectType == <span class="string">&quot;groups&quot;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        results = <span class="built_in">ldapDirectory</span>().<span class="built_in">groups</span>( filter );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>( objectType == <span class="string">&quot;users&quot;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        results = <span class="built_in">ldapDirectory</span>().<span class="built_in">users</span>( filter );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> InvalidArguments;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>( <span class="type">const</span> <span class="keyword">auto</span>&amp; result : <span class="built_in">qAsConst</span>( results ) )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>( <span class="string">&quot;%s\n&quot;</span>, <span class="built_in">qUtf8Printable</span>( result ) );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Successful;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Example#9<br>
File: notify.cpp Project: andrew-bibb/cmst</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/////////////////////////////////////// PRIVATE FUNCTIONS////////////////////////////////</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Function to get information about the server and write results to data members</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">NotifyClient::getServerInformation</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// return if we don&#x27;t have valid connection</span></span><br><span class="line">  <span class="keyword">if</span> (! b_validconnection) <span class="keyword">return</span>; </span><br><span class="line">  </span><br><span class="line">  <span class="comment">// get the server information</span></span><br><span class="line">  QDBusMessage reply = notifyclient-&gt;<span class="built_in">call</span>(<span class="built_in">QLatin1String</span>(<span class="string">&quot;GetServerInformation&quot;</span>));</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (reply.<span class="built_in">type</span>() == QDBusMessage::ReplyMessage) &#123;</span><br><span class="line">    QList&lt;QVariant&gt; outargs = reply.<span class="built_in">arguments</span>();</span><br><span class="line">    s_name = outargs.<span class="built_in">at</span>(<span class="number">0</span>).<span class="built_in">toString</span>();</span><br><span class="line">    s_vendor = outargs.<span class="built_in">at</span>(<span class="number">1</span>).<span class="built_in">toString</span>();</span><br><span class="line">    s_version = outargs.<span class="built_in">at</span>(<span class="number">2</span>).<span class="built_in">toString</span>();</span><br><span class="line">    s_spec_version = outargs.<span class="built_in">at</span>(<span class="number">3</span>).<span class="built_in">toString</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (reply.<span class="built_in">type</span>() == QDBusMessage::InvalidMessage)</span><br><span class="line">      <span class="built_in">qCritical</span>(<span class="string">&quot;CMST - Invalid reply received to GetServerInformation method.&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (reply.<span class="built_in">type</span>() == QDBusMessage::ErrorMessage) </span><br><span class="line">    <span class="meta">#<span class="keyword">if</span> QT_VERSION &gt;= 0x050400 </span></span><br><span class="line">            <span class="built_in">qCritical</span>(<span class="string">&quot;CMST - Error reply received to GetServerInforation method: %s&quot;</span>, <span class="built_in">qUtf8Printable</span>(reply.<span class="built_in">errorMessage</span>()) );</span><br><span class="line">    <span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">      <span class="built_in">qCritical</span>(<span class="string">&quot;CMST - Error reply received to GetServerInforation method: %s&quot;</span>, <span class="built_in">qPrintable</span>(reply.<span class="built_in">errorMessage</span>()) );</span><br><span class="line">    <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">  &#125; <span class="comment">// else some error occured</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Example#10<br>
File: meshlabdocumentbundler.cpp Project: ariesYangLi/meshlab</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">MeshDocumentFromNvm</span><span class="params">(MeshDocument &amp;md, QString filename_nvm, QString model_filename)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    md.<span class="built_in">addNewMesh</span>(model_filename,<span class="built_in">QString</span>(<span class="string">&quot;model&quot;</span>));</span><br><span class="line">    std::vector&lt;Shotm&gt; shots;</span><br><span class="line">    <span class="type">const</span> QString path = <span class="built_in">QFileInfo</span>(filename_nvm).<span class="built_in">absolutePath</span>();</span><br><span class="line">    <span class="comment">//const QString path_im = QFileInfo(image_list_filename).absolutePath()+QString(&quot;/&quot;);</span></span><br><span class="line"></span><br><span class="line">    std::vector&lt;std::string&gt;   image_filenames;</span><br><span class="line">    vcg::tri::io::ImporterNVM&lt;CMeshO&gt;::<span class="built_in">Open</span>(md.<span class="built_in">mm</span>()-&gt;cm,shots,image_filenames, <span class="built_in">qUtf8Printable</span>(filename_nvm));</span><br><span class="line">    md.<span class="built_in">mm</span>()-&gt;<span class="built_in">updateDataMask</span>(MeshModel::MM_VERTCOLOR);</span><br><span class="line"></span><br><span class="line">    QString curr_path = QDir::<span class="built_in">currentPath</span>();</span><br><span class="line">    <span class="comment">//QFileInfo imi(image_list_filename);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//QDir::setCurrent(imi.absoluteDir().absolutePath());</span></span><br><span class="line">    QStringList image_filenames_q;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">size_t</span> i  = <span class="number">0</span>; i &lt; image_filenames.<span class="built_in">size</span>(); ++i)</span><br><span class="line">        image_filenames_q.<span class="built_in">push_back</span>(QString::<span class="built_in">fromStdString</span>(image_filenames[<span class="built_in">int</span>(i)]));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">size_t</span> i=<span class="number">0</span> ; i&lt;shots.<span class="built_in">size</span>() ; i++)&#123;</span><br><span class="line">        md.<span class="built_in">addNewRaster</span>();</span><br><span class="line">        <span class="type">const</span> QString fullpath_image_filename = image_filenames_q[<span class="built_in">int</span>(i)];</span><br><span class="line">        md.<span class="built_in">rm</span>()-&gt;<span class="built_in">addPlane</span>(<span class="keyword">new</span> <span class="built_in">Plane</span>(fullpath_image_filename,Plane::RGBA));</span><br><span class="line">        md.<span class="built_in">rm</span>()-&gt;<span class="built_in">setLabel</span>(image_filenames_q[<span class="built_in">int</span>(i)].<span class="built_in">section</span>(<span class="string">&#x27;/&#x27;</span>,<span class="number">1</span>,<span class="number">2</span>));</span><br><span class="line">        md.<span class="built_in">rm</span>()-&gt;shot = shots[<span class="built_in">int</span>(i)];</span><br><span class="line">        <span class="comment">/*md.rm()-&gt;shot.Intrinsics.ViewportPx[0]=md.rm()-&gt;currentPlane-&gt;image.width();</span></span><br><span class="line"><span class="comment">        md.rm()-&gt;shot.Intrinsics.ViewportPx[1]=md.rm()-&gt;currentPlane-&gt;image.height();</span></span><br><span class="line"><span class="comment">        md.rm()-&gt;shot.Intrinsics.CenterPx[0]=(int)((double)md.rm()-&gt;shot.Intrinsics.ViewportPx[0]/2.0f);</span></span><br><span class="line"><span class="comment">        md.rm()-&gt;shot.Intrinsics.CenterPx[1]=(int)((double)md.rm()-&gt;shot.Intrinsics.ViewportPx[1]/2.0f);*/</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    QDir::<span class="built_in">setCurrent</span>(curr_path);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Example#11<br>
File: downloadmanager.cpp Project: qbittorrent/qBittorrent</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Net::DownloadHandler *Net::DownloadManager::<span class="built_in">download</span>(<span class="type">const</span> DownloadRequest &amp;downloadRequest)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Process download request</span></span><br><span class="line">    <span class="type">const</span> QNetworkRequest request = <span class="built_in">createNetworkRequest</span>(downloadRequest);</span><br><span class="line">    <span class="type">const</span> ServiceID id = ServiceID::<span class="built_in">fromURL</span>(request.<span class="built_in">url</span>());</span><br><span class="line">    <span class="type">const</span> <span class="type">bool</span> isSequentialService = m_sequentialServices.<span class="built_in">contains</span>(id);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> downloadHandler = <span class="keyword">new</span> DownloadHandlerImpl &#123;downloadRequest, <span class="keyword">this</span>&#125;;</span><br><span class="line">    <span class="built_in">connect</span>(downloadHandler, &amp;DownloadHandler::finished, downloadHandler, &amp;QObject::deleteLater);</span><br><span class="line">    <span class="built_in">connect</span>(downloadHandler, &amp;QObject::destroyed, <span class="keyword">this</span>, [<span class="keyword">this</span>, id, downloadHandler]()</span><br><span class="line">    &#123;</span><br><span class="line">        m_waitingJobs[id].<span class="built_in">removeOne</span>(downloadHandler);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!isSequentialService || !m_busyServices.<span class="built_in">contains</span>(id)) &#123;</span><br><span class="line">        <span class="built_in">qDebug</span>(<span class="string">&quot;Downloading %s...&quot;</span>, <span class="built_in">qUtf8Printable</span>(downloadRequest.<span class="built_in">url</span>()));</span><br><span class="line">        <span class="keyword">if</span> (isSequentialService)</span><br><span class="line">            m_busyServices.<span class="built_in">insert</span>(id);</span><br><span class="line">        downloadHandler-&gt;<span class="built_in">assignNetworkReply</span>(m_networkManager.<span class="built_in">get</span>(request));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        m_waitingJobs[id].<span class="built_in">enqueue</span>(downloadHandler);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> downloadHandler;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Example#12<br>
File: downloadhandler.cpp Project: elFarto/qBittorrent</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> Net::DownloadHandler::<span class="built_in">processFinishedDownload</span>()</span><br><span class="line">&#123;</span><br><span class="line">    QString url = m_reply-&gt;<span class="built_in">url</span>().<span class="built_in">toString</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>(<span class="string">&quot;Download finished: %s&quot;</span>, <span class="built_in">qUtf8Printable</span>(url));</span><br><span class="line">    <span class="comment">// Check if the request was successful</span></span><br><span class="line">    <span class="keyword">if</span> (m_reply-&gt;<span class="built_in">error</span>() != QNetworkReply::NoError) &#123;</span><br><span class="line">        <span class="comment">// Failure</span></span><br><span class="line">        <span class="built_in">qDebug</span>(<span class="string">&quot;Download failure (%s), reason: %s&quot;</span>, <span class="built_in">qUtf8Printable</span>(url), <span class="built_in">qUtf8Printable</span>(<span class="built_in">errorCodeToString</span>(m_reply-&gt;<span class="built_in">error</span>())));</span><br><span class="line">        <span class="function">emit <span class="title">downloadFailed</span><span class="params">(m_downloadRequest.url(), errorCodeToString(m_reply-&gt;error()))</span></span>;</span><br><span class="line">        <span class="keyword">this</span>-&gt;<span class="built_in">deleteLater</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Check if the server ask us to redirect somewhere else</span></span><br><span class="line">        <span class="type">const</span> QVariant redirection = m_reply-&gt;<span class="built_in">attribute</span>(QNetworkRequest::RedirectionTargetAttribute);</span><br><span class="line">        <span class="keyword">if</span> (redirection.<span class="built_in">isValid</span>()) &#123;</span><br><span class="line">            <span class="comment">// We should redirect</span></span><br><span class="line">            <span class="built_in">handleRedirection</span>(redirection.<span class="built_in">toUrl</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Success</span></span><br><span class="line">            QByteArray replyData = m_reply-&gt;<span class="built_in">readAll</span>();</span><br><span class="line">            <span class="keyword">if</span> (m_reply-&gt;<span class="built_in">rawHeader</span>(<span class="string">&quot;Content-Encoding&quot;</span>) == <span class="string">&quot;gzip&quot;</span>) &#123;</span><br><span class="line">                <span class="comment">// decompress gzip reply</span></span><br><span class="line">                replyData = Utils::Gzip::<span class="built_in">decompress</span>(replyData);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (m_downloadRequest.<span class="built_in">saveToFile</span>()) &#123;</span><br><span class="line">                QString filePath;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">saveToFile</span>(replyData, filePath))</span><br><span class="line">                    <span class="function">emit <span class="title">downloadFinished</span><span class="params">(m_downloadRequest.url(), filePath)</span></span>;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    emit <span class="built_in">downloadFailed</span>(m_downloadRequest.<span class="built_in">url</span>(), <span class="built_in">tr</span>(<span class="string">&quot;I/O Error&quot;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                emit <span class="built_in">downloadFinished</span>(m_downloadRequest.<span class="built_in">url</span>(), replyData);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">this</span>-&gt;<span class="built_in">deleteLater</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Example#13<br>
File: dbfunc.cpp Project: RudolfCardinal/camcops</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">DbFunc::execQuery</span><span class="params">(QSqlQuery&amp; query, <span class="type">const</span> QString&amp; sql,</span></span></span><br><span class="line"><span class="params"><span class="function">                       <span class="type">const</span> ArgList&amp; args)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Executes an existing query (in place) with the supplied SQL/args.</span></span><br><span class="line">    <span class="comment">// THIS IS THE MAIN POINT THROUGH WHICH ALL QUERIES SHOULD BE EXECUTED.</span></span><br><span class="line">    query.<span class="built_in">prepare</span>(sql);</span><br><span class="line">    <span class="built_in">addArgs</span>(query, args);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> DEBUG_SQL_QUERY</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Executing:&quot;</span> &lt;&lt; <span class="built_in">qUtf8Printable</span>(sql);</span><br><span class="line">        QDebug debug = <span class="built_in">qDebug</span>().<span class="built_in">nospace</span>();</span><br><span class="line">        debug &lt;&lt; <span class="string">&quot;... args: &quot;</span>;</span><br><span class="line">        DebugFunc::<span class="built_in">debugConcisely</span>(debug, args);</span><br><span class="line">    &#125;  <span class="comment">// endl on destruction</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    <span class="type">bool</span> success = query.<span class="built_in">exec</span>();</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> DEBUG_QUERY_END</span></span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;... query finished&quot;</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="keyword">if</span> (!success) &#123;</span><br><span class="line">        <span class="built_in">qCritical</span>() &lt;&lt; <span class="string">&quot;Query failed; error was:&quot;</span> &lt;&lt; query.<span class="built_in">lastError</span>();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> DEBUG_SQL_RESULT</span></span><br><span class="line">    <span class="keyword">if</span> (success &amp;&amp; query.<span class="built_in">isSelect</span>() &amp;&amp; !query.<span class="built_in">isForwardOnly</span>()) &#123;</span><br><span class="line">        <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;Resultset preview:&quot;</span>;</span><br><span class="line">        <span class="type">int</span> row = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (query.<span class="built_in">next</span>()) &#123;</span><br><span class="line">            QDebug debug = <span class="built_in">qDebug</span>().<span class="built_in">nospace</span>();</span><br><span class="line">            QSqlRecord rec = query.<span class="built_in">record</span>();</span><br><span class="line">            <span class="type">int</span> ncols = rec.<span class="built_in">count</span>();</span><br><span class="line">            debug &lt;&lt; <span class="string">&quot;... row &quot;</span> &lt;&lt; row &lt;&lt; <span class="string">&quot;: &quot;</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> col = <span class="number">0</span>; col &lt; ncols; ++col) &#123;</span><br><span class="line">                <span class="keyword">if</span> (col &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    debug &lt;&lt; <span class="string">&quot;; &quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                debug &lt;&lt; rec.<span class="built_in">fieldName</span>(col) &lt;&lt; <span class="string">&quot;=&quot;</span>;</span><br><span class="line">                DebugFunc::<span class="built_in">debugConcisely</span>(debug, query.<span class="built_in">value</span>(col));</span><br><span class="line">            &#125;</span><br><span class="line">            ++row;</span><br><span class="line">        &#125;  <span class="comment">// endl on destruction</span></span><br><span class="line">        <span class="keyword">if</span> (row == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;&lt;no rows&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        query.<span class="built_in">seek</span>(QSql::BeforeFirstRow);  <span class="comment">// the original starting position</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="keyword">return</span> success;</span><br><span class="line">    <span class="comment">// The return value is boolean (success?).</span></span><br><span class="line">    <span class="comment">// Use query.next() to iterate through a result set; see</span></span><br><span class="line">    <span class="comment">// http://doc.qt.io/qt-4.8/sql-sqlstatements.html</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Example#14<br>
File: parser_test.cpp Project: mNisblee/QTouch</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">XmlParserTest::initTestCase</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Create a validator</span></span><br><span class="line">        validator = <span class="built_in">createValidator</span>(<span class="built_in">QStringLiteral</span>(<span class="string">&quot;:/courses/course.xsd&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">catch</span> (Exception&amp; e)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">QFAIL</span>(<span class="built_in">qUtf8Printable</span>(e.<span class="built_in">message</span>()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Example#15<br>
File: downloadmanager.cpp Project: qbittorrent/qBittorrent</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> Net::DownloadManager::<span class="built_in">handleReplyFinished</span>(<span class="type">const</span> QNetworkReply *reply)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">const</span> ServiceID id = ServiceID::<span class="built_in">fromURL</span>(reply-&gt;<span class="built_in">url</span>());</span><br><span class="line">    <span class="type">const</span> <span class="keyword">auto</span> waitingJobsIter = m_waitingJobs.<span class="built_in">find</span>(id);</span><br><span class="line">    <span class="keyword">if</span> ((waitingJobsIter == m_waitingJobs.<span class="built_in">end</span>()) || waitingJobsIter.<span class="built_in">value</span>().<span class="built_in">isEmpty</span>()) &#123;</span><br><span class="line">        m_busyServices.<span class="built_in">remove</span>(id);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> handler = <span class="built_in">static_cast</span>&lt;DownloadHandlerImpl *&gt;(waitingJobsIter.<span class="built_in">value</span>().<span class="built_in">dequeue</span>());</span><br><span class="line">    <span class="built_in">qDebug</span>(<span class="string">&quot;Downloading %s...&quot;</span>, <span class="built_in">qUtf8Printable</span>(handler-&gt;<span class="built_in">url</span>()));</span><br><span class="line">    handler-&gt;<span class="built_in">assignNetworkReply</span>(m_networkManager.<span class="built_in">get</span>(<span class="built_in">createNetworkRequest</span>(handler-&gt;<span class="built_in">downloadRequest</span>())));</span><br><span class="line">    handler-&gt;<span class="built_in">disconnect</span>(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Example#16<br>
File: scanfoldersmodel.cpp Project: paolo-sz/qBittorrent</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">ScanFoldersModel::addTorrentsToSession</span><span class="params">(<span class="type">const</span> QStringList &amp;pathList)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> QString &amp;file : pathList) &#123;</span><br><span class="line">        <span class="built_in">qDebug</span>(<span class="string">&quot;File %s added&quot;</span>, <span class="built_in">qUtf8Printable</span>(file));</span><br><span class="line"></span><br><span class="line">        BitTorrent::AddTorrentParams params;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">downloadInWatchFolder</span>(file))</span><br><span class="line">            params.savePath = <span class="built_in">QFileInfo</span>(file).<span class="built_in">dir</span>().<span class="built_in">path</span>();</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">downloadInDefaultFolder</span>(file))</span><br><span class="line">            params.savePath = <span class="built_in">downloadPathTorrentFolder</span>(file);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (file.<span class="built_in">endsWith</span>(<span class="string">&quot;.magnet&quot;</span>)) &#123;</span><br><span class="line">            <span class="function">QFile <span class="title">f</span><span class="params">(file)</span></span>;</span><br><span class="line">            <span class="keyword">if</span> (f.<span class="built_in">open</span>(QIODevice::ReadOnly | QIODevice::Text)) &#123;</span><br><span class="line">                <span class="function">QTextStream <span class="title">str</span><span class="params">(&amp;f)</span></span>;</span><br><span class="line">                <span class="keyword">while</span> (!str.<span class="built_in">atEnd</span>())</span><br><span class="line">                    BitTorrent::Session::<span class="built_in">instance</span>()-&gt;<span class="built_in">addTorrent</span>(str.<span class="built_in">readLine</span>(), params);</span><br><span class="line"></span><br><span class="line">                f.<span class="built_in">close</span>();</span><br><span class="line">                Utils::Fs::forceRemove(file);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">qDebug</span>(<span class="string">&quot;Failed to open magnet file: %s&quot;</span>, <span class="built_in">qUtf8Printable</span>(f.<span class="built_in">errorString</span>()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">const</span> BitTorrent::TorrentInfo torrentInfo = BitTorrent::TorrentInfo::<span class="built_in">loadFromFile</span>(file);</span><br><span class="line">            <span class="keyword">if</span> (torrentInfo.<span class="built_in">isValid</span>()) &#123;</span><br><span class="line">                BitTorrent::Session::<span class="built_in">instance</span>()-&gt;<span class="built_in">addTorrent</span>(torrentInfo, params);</span><br><span class="line">                Utils::Fs::forceRemove(file);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">qDebug</span>(<span class="string">&quot;Ignoring incomplete torrent file: %s&quot;</span>, <span class="built_in">qUtf8Printable</span>(file));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Example#17<br>
File: searchwidget.cpp Project: zywo/qBittorrent</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">SearchWidget::fillCatCombobox</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_ui-&gt;comboCategory-&gt;<span class="built_in">clear</span>();</span><br><span class="line">    m_ui-&gt;comboCategory-&gt;<span class="built_in">addItem</span>(SearchPluginManager::<span class="built_in">categoryFullName</span>(<span class="string">&quot;all&quot;</span>), <span class="built_in">QVariant</span>(<span class="string">&quot;all&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">using</span> QStrPair = QPair&lt;QString, QString&gt;;</span><br><span class="line">    QList&lt;QStrPair&gt; tmpList;</span><br><span class="line">    foreach (<span class="type">const</span> QString &amp;cat, SearchPluginManager::<span class="built_in">instance</span>()-&gt;<span class="built_in">getPluginCategories</span>(<span class="built_in">selectedPlugin</span>()))</span><br><span class="line">        tmpList &lt;&lt; <span class="built_in">qMakePair</span>(SearchPluginManager::<span class="built_in">categoryFullName</span>(cat), cat);</span><br><span class="line">    std::<span class="built_in">sort</span>(tmpList.<span class="built_in">begin</span>(), tmpList.<span class="built_in">end</span>(), [](<span class="type">const</span> QStrPair &amp;l, <span class="type">const</span> QStrPair &amp;r) &#123; <span class="built_in">return</span> (QString::<span class="built_in">localeAwareCompare</span>(l.first, r.first) &lt; <span class="number">0</span>); &#125;);</span><br><span class="line"></span><br><span class="line">    foreach (<span class="type">const</span> QStrPair &amp;p, tmpList) &#123;</span><br><span class="line">        <span class="built_in">qDebug</span>(<span class="string">&quot;Supported category: %s&quot;</span>, <span class="built_in">qUtf8Printable</span>(p.second));</span><br><span class="line">        m_ui-&gt;comboCategory-&gt;<span class="built_in">addItem</span>(p.first, <span class="built_in">QVariant</span>(p.second));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Example#18<br>
File: preferences.cpp Project: Gelmir/qBittorrent</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Preferences::isMagnetLinkAssocSet</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QSettings <span class="title">settings</span><span class="params">(<span class="string">&quot;HKEY_CURRENT_USER\\Software\\Classes&quot;</span>, QSettings::NativeFormat)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check magnet link assoc</span></span><br><span class="line">    <span class="function">QRegExp <span class="title">exe_reg</span><span class="params">(<span class="string">&quot;\&quot;([^\&quot;]+)\&quot;.*&quot;</span>)</span></span>;</span><br><span class="line">    QString shell_command = Utils::Fs::<span class="built_in">toNativePath</span>(settings.<span class="built_in">value</span>(<span class="string">&quot;magnet/shell/open/command/Default&quot;</span>, <span class="string">&quot;&quot;</span>).<span class="built_in">toString</span>());</span><br><span class="line">    <span class="keyword">if</span> (exe_reg.<span class="built_in">indexIn</span>(shell_command) &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    QString assoc_exe = exe_reg.<span class="built_in">cap</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">qDebug</span>(<span class="string">&quot;exe: %s&quot;</span>, <span class="built_in">qUtf8Printable</span>(assoc_exe));</span><br><span class="line">    <span class="keyword">if</span> (assoc_exe.<span class="built_in">compare</span>(Utils::Fs::<span class="built_in">toNativePath</span>(qApp-&gt;<span class="built_in">applicationFilePath</span>()), Qt::CaseInsensitive) != <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Example#19<br>
File: qtemporarydir.cpp Project: RSATom/Qt</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*!</span></span><br><span class="line"><span class="comment">    \since 5.9</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    Returns the path name of a file in the temporary directory.</span></span><br><span class="line"><span class="comment">    Does \e not check if the file actually exists in the directory.</span></span><br><span class="line"><span class="comment">    Redundant multiple separators or &quot;.&quot; and &quot;..&quot; directories in</span></span><br><span class="line"><span class="comment">    \a fileName are not removed (see QDir::cleanPath()). Absolute</span></span><br><span class="line"><span class="comment">    paths are not allowed.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">QString <span class="title">QTemporaryDir::filePath</span><span class="params">(<span class="type">const</span> QString &amp;fileName)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (QDir::<span class="built_in">isAbsolutePath</span>(fileName)) &#123;</span><br><span class="line">        <span class="built_in">qWarning</span>(<span class="string">&quot;QTemporaryDir::filePath: Absolute paths are not allowed: %s&quot;</span>, <span class="built_in">qUtf8Printable</span>(fileName));</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">QString</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!d_ptr-&gt;success)</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">QString</span>();</span><br><span class="line"></span><br><span class="line">    QString ret = d_ptr-&gt;pathOrError;</span><br><span class="line">    <span class="keyword">if</span> (!fileName.<span class="built_in">isEmpty</span>()) &#123;</span><br><span class="line">        ret += <span class="built_in">QLatin1Char</span>(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">        ret += fileName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Example#20<br>
File: meshlabdocumentbundler.cpp Project: ariesYangLi/meshlab</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">MeshDocumentFromBundler</span><span class="params">(MeshDocument &amp;md, QString filename_out,QString image_list_filename, QString model_filename)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    md.<span class="built_in">addNewMesh</span>(model_filename,<span class="built_in">QString</span>(<span class="string">&quot;model&quot;</span>));</span><br><span class="line">    std::vector&lt;Shotm&gt; shots;</span><br><span class="line">    <span class="type">const</span> QString path = <span class="built_in">QFileInfo</span>(filename_out).<span class="built_in">absolutePath</span>();</span><br><span class="line">    <span class="type">const</span> QString path_im = <span class="built_in">QFileInfo</span>(image_list_filename).<span class="built_in">absolutePath</span>()+<span class="built_in">QString</span>(<span class="string">&quot;/&quot;</span>);</span><br><span class="line"></span><br><span class="line">    std::vector&lt;std::string&gt;   image_filenames;</span><br><span class="line">    vcg::tri::io::ImporterOUT&lt;CMeshO&gt;::<span class="built_in">Open</span>(md.<span class="built_in">mm</span>()-&gt;cm,shots,image_filenames, <span class="built_in">qUtf8Printable</span>(filename_out), <span class="built_in">qUtf8Printable</span>(image_list_filename));</span><br><span class="line">    md.<span class="built_in">mm</span>()-&gt;<span class="built_in">updateDataMask</span>(MeshModel::MM_VERTCOLOR);</span><br><span class="line"></span><br><span class="line">    QString curr_path = QDir::<span class="built_in">currentPath</span>();</span><br><span class="line">    <span class="function">QFileInfo <span class="title">imi</span><span class="params">(image_list_filename)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    QStringList image_filenames_q;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">unsigned</span> <span class="type">int</span> i  = <span class="number">0</span>; i &lt; image_filenames.<span class="built_in">size</span>(); ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function">QImageReader <span class="title">sizeImg</span><span class="params">(QString::fromStdString(image_filenames[i]))</span></span>;</span><br><span class="line">        <span class="keyword">if</span>(sizeImg.<span class="built_in">size</span>()==<span class="built_in">QSize</span>(<span class="number">-1</span>,<span class="number">-1</span>))</span><br><span class="line">            image_filenames_q.<span class="built_in">push_back</span>(path_im+QString::<span class="built_in">fromStdString</span>(image_filenames[i]));</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            image_filenames_q.<span class="built_in">push_back</span>(QString::<span class="built_in">fromStdString</span>(image_filenames[i]));</span><br><span class="line">    &#125;</span><br><span class="line">    QDir::<span class="built_in">setCurrent</span>(imi.<span class="built_in">absoluteDir</span>().<span class="built_in">absolutePath</span>());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">size_t</span> i=<span class="number">0</span> ; i&lt;shots.<span class="built_in">size</span>() ; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        md.<span class="built_in">addNewRaster</span>();</span><br><span class="line">        <span class="type">const</span> QString fullpath_image_filename = image_filenames_q[<span class="built_in">int</span>(i)];</span><br><span class="line">        md.<span class="built_in">rm</span>()-&gt;<span class="built_in">addPlane</span>(<span class="keyword">new</span> <span class="built_in">Plane</span>(fullpath_image_filename,Plane::RGBA));</span><br><span class="line">        <span class="type">int</span> count=fullpath_image_filename.<span class="built_in">count</span>(<span class="string">&#x27;\\&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (count==<span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            count=fullpath_image_filename.<span class="built_in">count</span>(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">            md.<span class="built_in">rm</span>()-&gt;<span class="built_in">setLabel</span>(fullpath_image_filename.<span class="built_in">section</span>(<span class="string">&#x27;/&#x27;</span>,count,<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            md.<span class="built_in">rm</span>()-&gt;<span class="built_in">setLabel</span>(fullpath_image_filename.<span class="built_in">section</span>(<span class="string">&#x27;\\&#x27;</span>,count,<span class="number">1</span>));</span><br><span class="line">        md.<span class="built_in">rm</span>()-&gt;shot = shots[i];</span><br><span class="line">    &#125;</span><br><span class="line">    QDir::<span class="built_in">setCurrent</span>(curr_path);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Example#21<br>
File: application.cpp Project: suratovvlad/qBittorrent</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Application::event</span><span class="params">(QEvent *ev)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (ev-&gt;<span class="built_in">type</span>() == QEvent::FileOpen) &#123;</span><br><span class="line">        QString path = <span class="built_in">static_cast</span>&lt;QFileOpenEvent *&gt;(ev)-&gt;<span class="built_in">file</span>();</span><br><span class="line">        <span class="keyword">if</span> (path.<span class="built_in">isEmpty</span>())</span><br><span class="line">            <span class="comment">// Get the url instead</span></span><br><span class="line">            path = <span class="built_in">static_cast</span>&lt;QFileOpenEvent *&gt;(ev)-&gt;<span class="built_in">url</span>().<span class="built_in">toString</span>();</span><br><span class="line">        <span class="built_in">qDebug</span>(<span class="string">&quot;Received a mac file open event: %s&quot;</span>, <span class="built_in">qUtf8Printable</span>(path));</span><br><span class="line">        <span class="keyword">if</span> (m_running)</span><br><span class="line">            <span class="built_in">processParams</span>(<span class="built_in">QStringList</span>(path));</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            m_paramsQueue.<span class="built_in">append</span>(path);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> BaseApplication::<span class="built_in">event</span>(ev);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Example#22<br>
File: parser_test.cpp Project: mNisblee/QTouch</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">XmlParserTest::parseTestCourse</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ParseResult result;</span><br><span class="line">    QString message;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> course = <span class="built_in">parseCourse</span>(<span class="built_in">QStringLiteral</span>(<span class="string">&quot;:/testing/courses/testcourse.xml&quot;</span>), *validator, &amp;result,</span><br><span class="line">                             &amp;message);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">verifyTestCourse</span>(*course);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">catch</span> (Exception&amp; e)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">QFAIL</span>(<span class="built_in">qUtf8Printable</span>(e.<span class="built_in">message</span>()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Example#23<br>
File: downloadhandler.cpp Project: elFarto/qBittorrent</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> Net::DownloadHandler::<span class="built_in">handleRedirection</span>(QUrl newUrl)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Resolve relative urls</span></span><br><span class="line">    <span class="keyword">if</span> (newUrl.<span class="built_in">isRelative</span>())</span><br><span class="line">        newUrl = m_reply-&gt;<span class="built_in">url</span>().<span class="built_in">resolved</span>(newUrl);</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> QString newUrlString = newUrl.<span class="built_in">toString</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>(<span class="string">&quot;Redirecting from %s to %s...&quot;</span>, <span class="built_in">qUtf8Printable</span>(m_reply-&gt;<span class="built_in">url</span>().<span class="built_in">toString</span>()), <span class="built_in">qUtf8Printable</span>(newUrlString));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Redirect to magnet workaround</span></span><br><span class="line">    <span class="keyword">if</span> (newUrlString.<span class="built_in">startsWith</span>(<span class="string">&quot;magnet:&quot;</span>, Qt::CaseInsensitive)) &#123;</span><br><span class="line">        <span class="built_in">qDebug</span>(<span class="string">&quot;Magnet redirect detected.&quot;</span>);</span><br><span class="line">        m_reply-&gt;<span class="built_in">abort</span>();</span><br><span class="line">        <span class="keyword">if</span> (m_downloadRequest.<span class="built_in">handleRedirectToMagnet</span>())</span><br><span class="line">            <span class="function">emit <span class="title">redirectedToMagnet</span><span class="params">(m_downloadRequest.url(), newUrlString)</span></span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            emit <span class="built_in">downloadFailed</span>(m_downloadRequest.<span class="built_in">url</span>(), <span class="built_in">tr</span>(<span class="string">&quot;Unexpected redirect to magnet URI.&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>-&gt;<span class="built_in">deleteLater</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        DownloadHandler *redirected = m_manager-&gt;<span class="built_in">download</span>(<span class="built_in">DownloadRequest</span>(m_downloadRequest).<span class="built_in">url</span>(newUrlString));</span><br><span class="line">        <span class="built_in">connect</span>(redirected, &amp;DownloadHandler::destroyed, <span class="keyword">this</span>, &amp;DownloadHandler::deleteLater);</span><br><span class="line">        <span class="built_in">connect</span>(redirected, &amp;DownloadHandler::downloadFailed, <span class="keyword">this</span>, [<span class="keyword">this</span>](<span class="type">const</span> QString &amp;, <span class="type">const</span> QString &amp;reason)</span><br><span class="line">        &#123;</span><br><span class="line">            emit <span class="built_in">downloadFailed</span>(<span class="built_in">url</span>(), reason);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="built_in">connect</span>(redirected, &amp;DownloadHandler::redirectedToMagnet, <span class="keyword">this</span>, [<span class="keyword">this</span>](<span class="type">const</span> QString &amp;, <span class="type">const</span> QString &amp;magnetUri)</span><br><span class="line">        &#123;</span><br><span class="line">            emit <span class="built_in">redirectedToMagnet</span>(<span class="built_in">url</span>(), magnetUri);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="built_in">connect</span>(redirected, <span class="built_in">static_cast</span>&lt;<span class="built_in">void</span> (DownloadHandler::*)(<span class="type">const</span> QString &amp;, <span class="type">const</span> QString &amp;)&gt;(&amp;DownloadHandler::downloadFinished)</span><br><span class="line">                , <span class="keyword">this</span>, [<span class="keyword">this</span>](<span class="type">const</span> QString &amp;, <span class="type">const</span> QString &amp;fileName)</span><br><span class="line">        &#123;</span><br><span class="line">            emit <span class="built_in">downloadFinished</span>(<span class="built_in">url</span>(), fileName);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="built_in">connect</span>(redirected, <span class="built_in">static_cast</span>&lt;<span class="built_in">void</span> (DownloadHandler::*)(<span class="type">const</span> QString &amp;, <span class="type">const</span> QByteArray &amp;)&gt;(&amp;DownloadHandler::downloadFinished)</span><br><span class="line">                , <span class="keyword">this</span>, [<span class="keyword">this</span>](<span class="type">const</span> QString &amp;, <span class="type">const</span> QByteArray &amp;data)</span><br><span class="line">        &#123;</span><br><span class="line">            emit <span class="built_in">downloadFinished</span>(<span class="built_in">url</span>(), data);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Example#24<br>
File: notify.cpp Project: andrew-bibb/cmst</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Function to get the capabilities of the server and write to a qstringlist data member</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">NotifyClient::getCapabilities</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// return if we don&#x27;t have valid connection</span></span><br><span class="line">  <span class="keyword">if</span> (! b_validconnection) <span class="keyword">return</span>;  </span><br><span class="line">  </span><br><span class="line">  <span class="comment">// get the server capabilities</span></span><br><span class="line">  QDBusReply&lt;QStringList&gt; reply = notifyclient-&gt;<span class="built_in">call</span>(<span class="built_in">QLatin1String</span>(<span class="string">&quot;GetCapabilities&quot;</span>) );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (reply.<span class="built_in">isValid</span>()) </span><br><span class="line">    sl_capabilities = reply.<span class="built_in">value</span>();</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  <span class="meta">#<span class="keyword">if</span> QT_VERSION &gt;= 0x050400 </span></span><br><span class="line">        <span class="built_in">qCritical</span>(<span class="string">&quot;CMST - Error reply received to GetCapabilities method: %s&quot;</span>, <span class="built_in">qUtf8Printable</span>(reply.<span class="built_in">error</span>().<span class="built_in">message</span>()) );</span><br><span class="line">  <span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">    <span class="built_in">qCritical</span>(<span class="string">&quot;CMST - Error reply received to GetCapabilities method: %s&quot;</span>, <span class="built_in">qPrintable</span>(reply.<span class="built_in">error</span>().<span class="built_in">message</span>()) );</span><br><span class="line">  <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Example#25<br>
File: notify.cpp Project: andrew-bibb/cmst</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  Function to force a close of a notification</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">NotifyClient::closeNotification</span><span class="params">(quint32 id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// return if we don&#x27;t have valid connection</span></span><br><span class="line">  <span class="keyword">if</span> (! b_validconnection) <span class="keyword">return</span>; </span><br><span class="line">  </span><br><span class="line">  QDBusMessage reply = notifyclient-&gt;<span class="built_in">call</span>(<span class="built_in">QLatin1String</span>(<span class="string">&quot;CloseNotification&quot;</span>), id);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (reply.<span class="built_in">type</span>() == QDBusMessage::InvalidMessage)</span><br><span class="line">    <span class="built_in">qCritical</span>(<span class="string">&quot;CMST - Invalid reply received to CloseNotification method.&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (reply.<span class="built_in">type</span>() == QDBusMessage::ErrorMessage) </span><br><span class="line">  <span class="meta">#<span class="keyword">if</span> QT_VERSION &gt;= 0x050400 </span></span><br><span class="line">        <span class="built_in">qCritical</span>(<span class="string">&quot;CMST - Error reply received to CloseNotification method: %s&quot;</span>, <span class="built_in">qUtf8Printable</span>(reply.<span class="built_in">errorMessage</span>()) );</span><br><span class="line">  <span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">    <span class="built_in">qCritical</span>(<span class="string">&quot;CMST - Error reply received to CloseNotification method: %s&quot;</span>, <span class="built_in">qPrintable</span>(reply.<span class="built_in">errorMessage</span>()) );</span><br><span class="line">  <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Example#26<br>
File: main.cpp Project: MojaveTom/QtReadEkm</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*!</span></span><br><span class="line"><span class="comment"> * \brief InitializeMeters -- Once per program execution actions.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Opens a connection to the database.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * For each meter in the args list, check to see if there is a table in the</span></span><br><span class="line"><span class="comment"> * database for the response from the meter.  If not, create the table.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Each meter has its time set to the local standard time.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * \param serialPort    Pointer to serial port for communication with meter.</span></span><br><span class="line"><span class="comment"> * \param args  List of meter ids from command line.</span></span><br><span class="line"><span class="comment"> * \return true if successful, false otherwise.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">InitializeMeters</span><span class="params">(QSerialPort *serialPort, <span class="type">const</span> QStringList &amp;args)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>(<span class="string">&quot;Begin&quot;</span>);</span><br><span class="line">    QSqlDatabase dbConn = QSqlDatabase::<span class="built_in">database</span>(ConnectionName);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!dbConn.<span class="built_in">isOpen</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">qCritical</span>() &lt;&lt; <span class="string">&quot;Unable to open database for meter data.&quot;</span>;</span><br><span class="line">        <span class="built_in">qInfo</span>() &lt;&lt; <span class="string">&quot;Return false&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">QSqlQuery <span class="title">query</span><span class="params">(dbConn)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*! Do meter initialization tasks for each meter.  */</span></span><br><span class="line">    foreach (QString meterId, args)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//! Expand meter id to all 12 characters.</span></span><br><span class="line">        QString fullMeterId = meterId.<span class="built_in">rightJustified</span>(<span class="built_in">sizeof</span>(RequestMsgV4.meterId), <span class="string">&#x27;0&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//! Check for the existence of database tables in which to store meter data.</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (fullMeterId.<span class="built_in">toLongLong</span>() &gt;= <span class="number">300000000</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Is a v.4 meter.</span></span><br><span class="line">            <span class="comment">//!  Set the time in the meter to the computer&#x27;s idea of the local standard time.</span></span><br><span class="line">            <span class="keyword">if</span> (!<span class="built_in">SetMeterTime</span>(serialPort, fullMeterId))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">qWarning</span>(<span class="string">&quot;Unable to set meter time for meter %s.&quot;</span>, <span class="built_in">qUtf8Printable</span>(fullMeterId));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Create the tables if they don&#x27;t exist.</span></span><br><span class="line">            <span class="built_in">VerifyDatabaseTable</span>(query, fullMeterId, <span class="string">&quot;_A&quot;</span>);</span><br><span class="line">            <span class="built_in">VerifyDatabaseTable</span>(query, fullMeterId, <span class="string">&quot;_B&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Is a v.3 meter.</span></span><br><span class="line">            <span class="comment">// Don&#x27;t try to set meter time for v.3 meter since I don&#x27;t know how to do it.</span></span><br><span class="line">            <span class="comment">// Create the table if it doesn&#x27;t exist.</span></span><br><span class="line">            <span class="built_in">VerifyDatabaseTable</span>(query, fullMeterId, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Example#27<br>
File: main.cpp Project: erwincoumans/Revive</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QGuiApplication <span class="title">a</span><span class="params">(argc, argv)</span></span>;</span><br><span class="line"></span><br><span class="line">    COpenVROverlayController::<span class="built_in">SharedInstance</span>()-&gt;<span class="built_in">Init</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get the base path</span></span><br><span class="line">    DWORD size = MAX_PATH;</span><br><span class="line">    WCHAR path[MAX_PATH];</span><br><span class="line">    HKEY oculusKey;</span><br><span class="line">    <span class="built_in">RegOpenKeyEx</span>(HKEY_LOCAL_MACHINE, <span class="string">L&quot;Software\\Oculus VR, LLC\\Oculus&quot;</span>, <span class="number">0</span>, KEY_READ | KEY_WOW64_32KEY, &amp;oculusKey);</span><br><span class="line">    <span class="built_in">RegQueryValueEx</span>(oculusKey, <span class="string">L&quot;Base&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, (PBYTE)path, &amp;size);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create a QML engine.</span></span><br><span class="line">    QQmlEngine qmlEngine;</span><br><span class="line">    qmlEngine.<span class="built_in">rootContext</span>()-&gt;<span class="built_in">setContextProperty</span>(<span class="string">&quot;ReviveManifest&quot;</span>, CReviveManifestController::<span class="built_in">SharedInstance</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set the properties.</span></span><br><span class="line">    QString str = QString::<span class="built_in">fromWCharArray</span>(path);</span><br><span class="line">    QUrl url = QUrl::<span class="built_in">fromLocalFile</span>(str);</span><br><span class="line">    QString base = QDir::<span class="built_in">fromNativeSeparators</span>(str);</span><br><span class="line">    qmlEngine.<span class="built_in">rootContext</span>()-&gt;<span class="built_in">setContextProperty</span>(<span class="string">&quot;baseURL&quot;</span>, url.<span class="built_in">url</span>());</span><br><span class="line">    qmlEngine.<span class="built_in">rootContext</span>()-&gt;<span class="built_in">setContextProperty</span>(<span class="string">&quot;basePath&quot;</span>, base);</span><br><span class="line"></span><br><span class="line">    <span class="function">QQmlComponent <span class="title">qmlComponent</span><span class="params">( &amp;qmlEngine, QUrl(<span class="string">&quot;qrc:/Overlay.qml&quot;</span>))</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (qmlComponent.<span class="built_in">isError</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">qDebug</span>(<span class="built_in">qUtf8Printable</span>(qmlComponent.<span class="built_in">errorString</span>()));</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    QObject *rootObject = qmlComponent.<span class="built_in">create</span>();</span><br><span class="line">    QQuickItem *rootItem = <span class="built_in">qobject_cast</span>&lt;QQuickItem*&gt;( rootObject );</span><br><span class="line"></span><br><span class="line">    COpenVROverlayController::<span class="built_in">SharedInstance</span>()-&gt;<span class="built_in">SetQuickItem</span>( rootItem );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// don&#x27;t show the window that you&#x27;re going display in an overlay</span></span><br><span class="line">    <span class="comment">//view.show();</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> a.<span class="built_in">exec</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Example#28<br>
File: justice_cmd.cpp Project: junqiang521/Test</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">justice_cmd::cancel</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!m_executor)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    redisContext *c = <span class="built_in">redisConnect</span>(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">    <span class="keyword">if</span> (!c)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (c-&gt;err != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">redisFree</span>(c);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">void</span> *reply  = <span class="built_in">redisCommand</span>(c, <span class="string">&quot;PUBLISH %s %s&quot;</span>, <span class="built_in">qUtf8Printable</span>(m_info_chnl), <span class="string">&quot;end&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (reply)</span><br><span class="line">        <span class="built_in">freeReplyObject</span>(reply);</span><br><span class="line">    <span class="built_in">redisFree</span>(c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Example#29<br>
File: parser_test.cpp Project: mNisblee/QTouch</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">XmlParserTest::parseCourses</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QDir <span class="title">coursepath</span><span class="params">(QStringLiteral(<span class="string">&quot;:/courses&quot;</span>), <span class="string">&quot;*.xml&quot;</span>, QDir::Name | QDir::IgnoreCase, QDir::Files)</span></span>;</span><br><span class="line"></span><br><span class="line">    QStringList coursefiles;</span><br><span class="line">    foreach(QString <span class="type">const</span> &amp; s, coursepath.<span class="built_in">entryList</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        coursefiles.<span class="built_in">append</span>(coursepath.<span class="built_in">filePath</span>(s));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; coursefiles;</span><br><span class="line"></span><br><span class="line">    QList&lt;std::shared_ptr&lt;Course&gt;&gt; courseList;</span><br><span class="line"></span><br><span class="line">    <span class="function">QStringListIterator <span class="title">it</span><span class="params">(coursefiles)</span></span>;</span><br><span class="line">    <span class="keyword">while</span> (it.<span class="built_in">hasNext</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        ParseResult result;</span><br><span class="line">        QString message;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">auto</span> course = <span class="built_in">parseCourse</span>(it.<span class="built_in">next</span>(), *validator, &amp;result, &amp;message);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (result != Ok)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">qWarning</span>() &lt;&lt; <span class="string">&quot;Result:&quot;</span> &lt;&lt; result &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; message;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            courseList.<span class="built_in">append</span>(course);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">catch</span> (Exception&amp; e)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">QFAIL</span>(<span class="built_in">qUtf8Printable</span>(e.<span class="built_in">message</span>()));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">QCOMPARE</span>(coursepath.<span class="built_in">entryList</span>().<span class="built_in">size</span>(), courseList.<span class="built_in">length</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Example#30<br>
File: downloadmanager.cpp Project: elFarto/qBittorrent</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Net::DownloadHandler *Net::DownloadManager::<span class="built_in">download</span>(<span class="type">const</span> DownloadRequest &amp;downloadRequest)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Process download request</span></span><br><span class="line">    <span class="type">const</span> QNetworkRequest request = <span class="built_in">createNetworkRequest</span>(downloadRequest);</span><br><span class="line">    <span class="type">const</span> ServiceID id = ServiceID::<span class="built_in">fromURL</span>(request.<span class="built_in">url</span>());</span><br><span class="line">    <span class="type">const</span> <span class="type">bool</span> isSequentialService = m_sequentialServices.<span class="built_in">contains</span>(id);</span><br><span class="line">    <span class="keyword">if</span> (!isSequentialService || !m_busyServices.<span class="built_in">contains</span>(id)) &#123;</span><br><span class="line">        <span class="built_in">qDebug</span>(<span class="string">&quot;Downloading %s...&quot;</span>, <span class="built_in">qUtf8Printable</span>(downloadRequest.<span class="built_in">url</span>()));</span><br><span class="line">        <span class="keyword">if</span> (isSequentialService)</span><br><span class="line">            m_busyServices.<span class="built_in">insert</span>(id);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DownloadHandler &#123;</span><br><span class="line">            m_networkManager.<span class="built_in">get</span>(request), <span class="keyword">this</span>, downloadRequest&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> *downloadHandler = <span class="keyword">new</span> DownloadHandler &#123;<span class="literal">nullptr</span>, <span class="keyword">this</span>, downloadRequest&#125;;</span><br><span class="line">    <span class="built_in">connect</span>(downloadHandler, &amp;DownloadHandler::destroyed, <span class="keyword">this</span>, [<span class="keyword">this</span>, id, downloadHandler]()</span><br><span class="line">    &#123;</span><br><span class="line">        m_waitingJobs[id].<span class="built_in">removeOne</span>(downloadHandler);</span><br><span class="line">    &#125;);</span><br><span class="line">    m_waitingJobs[id].<span class="built_in">enqueue</span>(downloadHandler);</span><br><span class="line">    <span class="keyword">return</span> downloadHandler;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Vinda</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://svinda.github.io/2022/10/08/Qt/qUtf8Printable/">https://svinda.github.io/2022/10/08/Qt/qUtf8Printable/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://svinda.github.io" target="_blank">Vinda's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Qt/">Qt</a></div><div class="post_share"><div class="social-share" data-image="/img/avatar.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="lv-container" data-id="city" data-uid="MTAyMC80NTI0OS8yMTc2NA=="></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Vinda</div><div class="author-info__description">开到荼蘼</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">87</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">24</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/svinda"><i class="fab fa-github"></i><span>My GitHub</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎大家收藏我的博客！</div></div><div class="card-widget connection" id="connection"><div class="item-headline"><i class="fa fa-address-card"></i><span>联系方式</span></div><div class="item-content"><html><body>QQ&#58; 210968619<br/>Email&#58; hwnd1024@163.com</body></html></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E4%BB%8B%E7%BB%8D%E5%8F%8A%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">1.</span> <span class="toc-text">函数介绍及注意事项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="toc-number">2.</span> <span class="toc-text">一些开源项目中使用的例子</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/10/08/Qt/QtGlobal/" title="QtGlobal 常用函数">QtGlobal 常用函数</a><time datetime="2022-10-08T01:28:45.000Z" title="发表于 2022-10-08 09:28:45">2022-10-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/10/08/Qt/qUtf8Printable/" title="qUtf8Printable">qUtf8Printable</a><time datetime="2022-10-07T18:53:48.000Z" title="发表于 2022-10-08 02:53:48">2022-10-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/10/07/OpenSourceProjects/NotePadNext/NotePadNext-1-%E7%AE%80%E4%BB%8B%E5%92%8C%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91/" title="NotePadNext：简介和源码编译">NotePadNext：简介和源码编译</a><time datetime="2022-10-07T00:11:34.000Z" title="发表于 2022-10-07 08:11:34">2022-10-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/10/07/OpenSourceProjects/NotePadNext/NotePadNext-0-%E5%BA%8F/" title="NotePadNext：序">NotePadNext：序</a><time datetime="2022-10-07T00:07:46.000Z" title="发表于 2022-10-07 08:07:46">2022-10-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/10/07/Qt/QtProblems/Qt%E9%97%AE%E9%A2%98-QtCreator%E8%B0%83%E8%AF%95%E7%A8%8B%E5%BA%8F%E9%97%AE%E9%A2%98/" title="Qt问题-QtCreator调试程序问题">Qt问题-QtCreator调试程序问题</a><time datetime="2022-10-06T22:11:00.000Z" title="发表于 2022-10-07 06:11:00">2022-10-07</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2023 By Vinda</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a href="httpshttps://github.com/svinda/">GitHub</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.css"><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script><script>function loadLivere () {
  if (typeof LivereTower === 'object') {
    window.LivereTower.init()
  }
  else {
    (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
    })(document, 'script');
  }
}

if ('Livere' === 'Livere' || !true) {
  if (true) btf.loadComment(document.getElementById('lv-container'), loadLivere)
  else loadLivere()
}
else {
  function loadOtherComment () {
    loadLivere()
  }
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>